name: BPB 最终部署方案

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - uses: actions/checkout@v4

      - name: 安装必要工具
        run: npm install -g wrangler@latest

      - name: 生成Worker文件
        run: |
          # 创建标准Worker文件
          cat <<EOF > _worker.js
          export default {
            async fetch() {
              return new Response('Hello World', {
                headers: {
                  'CF-IPCountry': 'US',
                  'X-Proxy-Location': 'US'
                }
              })
            }
          }
          EOF

          # 生成合规配置文件
          cat <<EOF > wrangler.toml
          name = "bpb-worker"
          main = "_worker.js"
          account_id = "你的账户ID"  # 必须替换为真实ID
          compatibility_date = "$(date +'%Y-%m-%d')"
          EOF

      - name: 执行部署
        run: wrangler deploy
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
